<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Teste Notificações Realtime</title>
  <!-- SockJS -->
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
  <!-- STOMP.js versão antiga (global Stomp) -->
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
  <h1>Notificações Realtime</h1>

  <div>
    <input type="text" id="userId" placeholder="User ID" />
    <input type="text" id="msg" placeholder="Mensagem" />
    <button onclick="sendNotification()">Enviar Notificação</button>
  </div>

  <h2>Notificações Recebidas:</h2>
  <ul id="notifications"></ul>

  <script>
    // -----------------------------
    // Conexão WebSocket com STOMP
    // -----------------------------
    const socket = new SockJS("https://animated-disco-v65rxg54vv6fpwr5-8080.app.github.dev/ws-notifications");
    const stompClient = Stomp.over(socket);

    stompClient.connect({}, function(frame) {
      console.log("Conectado via WebSocket:", frame);

      // Inscreve no tópico /topic/notifications
      stompClient.subscribe("/topic/notifications", function(message) {
        const notification = JSON.parse(message.body);
        addNotification(notification);
      });
    });

    // -----------------------------
    // Adiciona notificação na lista
    // -----------------------------
    function addNotification(notification) {
      const list = document.getElementById("notifications");
      const item = document.createElement("li");
      item.textContent = `[${notification.userId}] ${notification.msg} (Visto: ${notification.isVisto})`;
      list.appendChild(item);
    }

    // -----------------------------
    // Envia notificação via API REST
    // -----------------------------
    function sendNotification() {
      const userId = document.getElementById("userId").value;
      const msg = document.getElementById("msg").value;

      if (!userId || !msg) {
        alert("Preencha User ID e Mensagem!");
        return;
      }

      fetch("https://animated-disco-v65rxg54vv6fpwr5-8080.app.github.dev/notifications", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId, msg })
      })
      .then(res => res.json())
      .then(data => console.log("Notificação enviada:", data))
      .catch(err => console.error("Erro ao enviar notificação:", err));
    }
  </script>
</body>
</html>
